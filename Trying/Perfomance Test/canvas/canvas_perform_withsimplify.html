<!DOCTYPE html>
<html>
<head>
	<script src="../jquery.min.js"></script>
	<script src="../app.js"></script>
	<script src="../stats.js"></script>
	<script src="../simplify.js"></script>
	<script>

        $(document).ready( function() {
        	
        		stats = stats();
				

				$.getJSON( "../api/data.json", function( data ) {
					data_count = data.count;
					data = data.data;
				
					var aktiv_random = false;
					var interval_counter = 1;
					var limit_change = 0;
					var new_line_points;
					var update = function () {
						var line_points = new Array(new Array(0,0));
						$("#container").empty();
						var counter = 0;
						var y_range = 10;
						var all_line_points = new Array();
						var filter_counter = 0;
						
						// dont simplyfiy every time, only if there is a new set of date
						if($('#limit_lines').val() !=  limit_change){
							limit_change = $('#limit_lines').val();
							$.each(data, function(i,val){
								if($('#limit_lines').val() < filter_counter){
									return;
								}
								
								filter_counter++;
								y_range += 0.02;
								all_line_points.push({x:y_range, y:(val.chanels[0].value/50), time:val.time});	
							})
						
							var tolerance = $('#tolerance').val();
							var highQuality = false;
							new_line_points = simplify(all_line_points, tolerance, highQuality);
								
						}
						
					    interval_counter++;
					
						$('#linescount').html(data_count);
						var random_limit = Math.floor(Math.random() * data_count) + 1;
					    stats.begin();
					  
						//console.log(interval_counter);
					
							
						var c = document.getElementById("myCanvas");
						var context = c.getContext("2d");
						context.clearRect ( 0 , 0 , c.width, c.height );
						context.beginPath();
						context.moveTo(0, 0);
				
						$.each(new_line_points, function(i,val){
							
							if($('#limit_lines').val() < counter){
								return false;
							}
							counter++;

							
							var random_x = Math.floor(Math.random() * 100) + 1;
							
							y_range += 0.02;
							
							x1 =  val.x;
							y1 = val.y; ;

							//if(random_x > 99){
								context.lineTo(x1,y1);
							
							//}
      						
						  					  
						})
							
						$('#counter').html("Redraw Count:"+interval_counter);
						context.stroke();
						
						stats.end();
						$('#counter_simply').html(counter);
						$('#linescount').html(data_count);
				
						requestAnimationFrame( update );
					
					};
							
					requestAnimationFrame( update );

			});	
			
		
				
			
			
		   
		});
	
	</script>
</head>
<body>
<h1 style="text-align:center;">Canvas Lines - no simplify</h1>

<canvas id="myCanvas" width="1600" height="500" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

<p>Data exists for <a id="linescount"></a> Points</p>
<p>Value for max points:<input id="limit_lines" value="25000" type"name"/></p>
<p id="counter"></p>  
<p>Points left from Simplify: <a id="counter_simply"></a> </p> 
</body>
</html>