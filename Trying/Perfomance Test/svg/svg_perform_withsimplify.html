<!DOCTYPE html>
<html>
<head>
	<script src="../jquery.min.js"></script>
	<script src="../app.js"></script>
	<script src="../stats.js"></script>
	<script src="../simplify.js"></script>
	<script>

        $(document).ready( function() {
        		
				stats = stats();
				mstats = mstats();

				$.getJSON( "../api/data.json", function( data ) {
					data_count = data.count;
					data = data.data;
				
					var aktiv_random = false;
					var interval_counter = 1;
					

					var update = function () {
						var all_line_points = new Array();
						var y_range = 10;
						var filter_counter = 0;
						
						$.each(data, function(i,val){
							if($('#limit_lines').val() < filter_counter){
								return;
							}
							filter_counter++;
							y_range += 0.02;
							all_line_points.push({x:y_range, y:(val.chanels[0].value/50)});	
						})
						var tolerance = $('#tolerance').val();
						var highQuality = false;
						var new_line_points = simplify(all_line_points, tolerance, highQuality);
				
						$("#container").empty();
						var counter = 0;
						y_range = 10;
					    interval_counter++;
					
						$('#linescount').html(data_count);
						var random_limit = Math.floor(Math.random() * data_count) + 1;
					    stats.begin();
					    mstats.begin();
						//console.log(interval_counter);
						var line_points = new Array(new Array(0,0));
						$.each(new_line_points, function(i,val){
							//console.log(val);
						
							counter++;

							var random_x = Math.floor(Math.random() * 1000) + 1;
							//console.log( val.x+" "+ val.y);
							line_points.push(new Array( val.x, val.y));
							//console.log(line_points);
							if(counter > 1){
								line_points.shift();
							}
					
					
							x1 = line_points[0][0];
							y1 = line_points[0][1];
							x2 = line_points[1][0];
							y2 = line_points[1][1];
						
							
							if(true){
								var newLine = document.createElementNS('http://www.w3.org/2000/svg','line');
							    newLine.setAttribute('id','time_'+val.time);
							    newLine.setAttribute('x1',x1);
							    newLine.setAttribute('y1',y1);
							    newLine.setAttribute('x2',x2);
							    newLine.setAttribute('y2',y2);
							    newLine.setAttribute('style','stroke:rgb(0,0,0)');

								$("#container").append(newLine);	
							}
						  					  
						})
					
						
						mstats.end();
						stats.end();
						$('#counter').html(counter);
						$('#linescount').html(data_count);
				
						requestAnimationFrame( update );
					
					};
							
					requestAnimationFrame( update );

			});	
			
		
				
			
			
		   
		});
	
	</script>
</head>
<body>
<h1 style="text-align:center;">SVG Lines - with implify</h1>

<svg width="1600" height="500" top="200" id="container">

  </svg> 

<p>Data exists for <a id="linescount"></a> Points</p>
<p>Value for max points:<input id="limit_lines" value="25000" type"name"/></p>

<p>Value for Simplyfy Tolerance:<select id="tolerance"><option value="1">100%</option><option value="0.75">75%</option><option value="0.50">50%</option><option value="0.25">25%</option><option value="0">0%</option></select></p>


<p>Points left from Simplify: <a id="counter"></a> </p> 
</body>
</html>